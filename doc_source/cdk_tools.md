--------

 This documentation is for the developer preview release of the AWS CDK\. Do not use this version of the AWS CDK in production\. Subsequent releases of the AWS CDK will likely include breaking changes\. 

--------

# Command\-line Toolkit \(cdk\)<a name="cdk_tools"></a>

cdk \(the AWS CDK Toolkit\) is the main tool you use to interact with your AWS CDK app\. It executes the AWS CDK app you have written and compiled, interrogates the application model you have defined, and produces and deploys the AWS CloudFormation templates generated by the AWS CDK\.

There are two ways that you can tell cdk what command to use to run your AWS CDK app\. The first way is to include an explicit \-\-app option whenever you use a cdk command:

```
cdk --app 'node bin/main.js' synth
```

The second way is to add the following entry to the file `cdk.json`:

```
{
  "app": "node bin/main.js"
}
```

Here are the actions you can take on your CDK app \(this is the output of the cdk \-\-help command\):

```
Usage: cdk -a <cdk-app> COMMAND

Commands:
  list                        Lists all stacks in the app          [aliases: ls]
  synthesize [STACKS..]       Synthesizes and prints the CloudFormation template
                              for this stack                    [aliases: synth]
  bootstrap [ENVIRONMENTS..]  Deploys the CDK toolkit stack into an AWS
                              environment
  deploy [STACKS..]           Deploys the stack(s) named STACKS into your AWS
                              account
  destroy [STACKS..]          Destroy the stack(s) named STACKS
  diff [STACK]                Compares the specified stack with the deployed
                              stack or a local template file
  metadata [STACK]            Returns all metadata associated with this stack
  init [TEMPLATE]             Create a new, empty CDK project from a template.
                              Invoked without TEMPLATE, the app template will be
                              used.
  context                     Manage cached context values
  docs                        Opens the documentation in a browser[aliases: doc]
  doctor                      Check your set-up for potential problems

Options:
  --app, -a            REQUIRED: Command-line for executing your CDK app (e.g.
                       "node bin/my-app.js")                            [string]
  --context, -c        Add contextual string parameter.                  [array]
  --plugin, -p         Name or path of a node package that extend the CDK
                       features. Can be specified multiple times         [array]
  --rename             Rename stack name if different then the one defined in
                       the cloud executable                             [string]
  --trace              Print trace for stack warnings                  [boolean]
  --strict             Do not construct stacks with warnings           [boolean]
  --ignore-errors      Ignores synthesis errors, which will likely produce an
                       invalid output                 [boolean] [default: false]
  --json, -j           Use JSON output instead of YAML                 [boolean]
  --verbose, -v        Show debug logs                                 [boolean]
  --profile            Use the indicated AWS profile as the default environment
                                                                        [string]
  --proxy              Use the indicated proxy. Will read from HTTPS_PROXY
                       environment variable if not specified.           [string]
  --ec2creds, -i       Force trying to fetch EC2 instance credentials. Default:
                       guess EC2 instance status.                      [boolean]
  --version-reporting  Include the "AWS::CDK::Metadata" resource in synthesized
                       templates (enabled by default)                  [boolean]
  --path-metadata      Include "aws:cdk:path" CloudFormation metadata for each
                       resource (enabled by default)   [boolean] [default: true]
  --role-arn, -r       ARN of Role to use when invoking CloudFormation  [string]
  --version            Show version number                             [boolean]
  -h, --help           Show help                                       [boolean]

If your app has a single stack, there is no need to specify the stack name

If one of cdk.json or ~/.cdk.json exists, options specified there will be used
as defaults. Settings in cdk.json take precedence.
```

If your app has a single stack, there is no need to specify the stack name\.

If one of `cdk.json` or `~/.cdk.json` exists, options specified there are used as defaults\. Settings in `cdk.json` take precedence\.

## Security\-related changes<a name="cdk_tools_security"></a>

In order to protect you against unintended changes that affect your security posture, the CDK toolkit will prompt you to approve security\-related changes before deploying them\.

You change the level of changes that requires approval by specifying:

```
cdk deploy --require-approval LEVEL
```

Where *LEVEL* can be one of:

never  
Approval is never required\.

any\-change  
Requires approval on any IAM or security\-group related change\.

broadening  
\(default\) Requires approval when IAM statements or traffic rules are added\. Removals do not require approval\.

The setting also be configured in `cdk.json`:

```
{
  "app": "...",
  "requireApproval": "never"
}
```

## Version Reporting<a name="cdk_version_reporting"></a>

In order to gain insights in how the AWS CDK is used, the versions of libraries used by AWS CDK applications are collected and reported using a resource identified as `AWS::CDK::Metadata` that is added to AWS CloudFormation templates, and can easily be reviewed\. This information may also be used to identify stacks using a package with known serious security or reliability issues and contact their users with important information\.

The AWS CDK reports the name and version of npm modules that are loaded into the application at synthesis time, unless their `package.json` file contains the `"private": true` attribute\.

The `AWS::CDK::Metadata` resource looks like the following:

```
CDKMetadata:
  Type: "AWS::CDK::Metadata"
  Properties:
    Modules: "@aws-cdk/core=0.7.2-beta,@aws-cdk/s3=0.7.2-beta,lodash=4.17.10"
```

## Opting\-out from Version Reporting<a name="cdk_version_reporting_opt_out"></a>

To out\-out, use one of the following methods:
+ Use the cdk command with the the `--no-version-reporting` argument:

  ```
  cdk --no-version-reporting synth
  ```
+ Set `versionReporting` to **false** in `./cdk.json` or `~/cdk.json`:

  ```
  {
    "app": "...",
    "versionReporting": false
  }
  ```

## Plugins<a name="cdk_tools_plugins"></a>

The AWS CDK toolkit provides extension points that enable users to augment the features provided by the toolkit\. There is currently only one extension point, allowing users to define custom AWS credential providers, but other extension points may be added in the future as the needs arise\.

### Loading Plugins<a name="cdk_tools_loading_plugins"></a>

Plugins can be loaded by providing the Node module name \(or path\) to the AWS CDK toolkit:
+ Using the `--plugin` command line option, which can be specified multiple times:

  ```
  cdk list --plugin=module
  cdk deploy --plugin=module_1 --plugin=module_2
  ```
+ Adding entries to the `~/.cdk.json` or `cdk.json` file:

  ```
  {
    // ...
    "plugin": [
      "module_1",
      "module_2"
    ],
    // ...
  }
  ```

### Authoring Plugins<a name="cdk_tools_authoring_plugins"></a>

Plugins must be authored in TypeScript or Javascript, and are defined by implementing a Node module that implements the following protocol, and using [PluginHost\(\)](https://awslabs.github.io/aws-cdk/tools.html#aws-cdk.PluginHost) methods:

------
#### [ TypeScript ]

```
import cdk = require('aws-cdk');

export = {
  version: '1', // Version of the plugin infrastructure (currently always '1')
  init(host: cdk.PluginHost): void {
    // Your plugin initialization hook.
    // Use methods of host to register custom code with the CDK toolkit
  }
};
```

------
#### [ JavaScript ]

```
export = {
  version: '1', // Version of the plugin infrastructure (currently always '1')
  init(host) {
    // Your plugin initialization hook.
    // Use methods of host to register custom code with the CDK toolkit
  }
};
```

------

### Credential Provider Plugins<a name="cdk_tools_creds_plugins"></a>

Custom credential providers are classes implementing the [CredentialProviderSource\(\)](https://awslabs.github.io/aws-cdk/tools.html#aws-cdk.CredentialProviderSource) interface, and registered to the toolkit using the [registerCredentialProviderSource\(\)](https://awslabs.github.io/aws-cdk/tools.html#aws-cdk.PluginHost.registerCredentialProviderSource) method\.

------
#### [ TypeScript ]

```
import cdk = require('aws-cdk');
import aws = require('aws-sdk');

class CustomCredentialProviderSource implements cdk.CredentialProviderSource {
  public async isAvailable(): Promise<boolean> {
    // Return false if the plugin could determine it cannot be used (for example,
    // if it depends on files that are not present on this host).
    return true;
  }

  public async canProvideCredentials(accountId: string): Promise<boolean> {
    // Return false if the plugin is unable to provide credentials for the
    // requested account (for example if it's not managed by the credentials
    // system that this plugin adds support for).
    return true;
  }

  public async getProvider(accountId: string, mode: cdk.Mode): Promise<aws.Credentials> {
    let credentials: aws.Credentials;
    // Somehow obtain credentials in credentials, and return those.
    return credentials;
  }
}

export = {
  version = '1',
  init(host: cdk.PluginHost): void {
    // Register the credential provider to the PluginHost.
    host.registerCredentialProviderSource(new CustomCredentialProviderSource());
  }
};
```

------
#### [ JavaScript ]

```
class CustomCredentialProviderSource {
  async isAvailable() {
    // Return false if the plugin could determine it cannot be used (for example,
    // if it depends on files that are not present on this host).
    return true;
  }

  async canProvideCredentials(accountId) {
    // Return false if the plugin is unable to provide credentials for the
    // requested account (for example if it's not managed by the credentials
    // system that this plugin adds support for).
    return true;
  }

  async getProvider(accountId, mode) {
    let credentials;
    // Somehow obtain credentials in credentials, and return those.
    return credentials;
  }
}

export = {
  version = '1',
  init(host) {
    // Register the credential provider to the PluginHost.
    host.registerCredentialProviderSource(new CustomCredentialProviderSource());
  }
};
```

------

Note that the credentials obtained from the providers for a given account and mode will be cached, and as a consequence it is strongly advised that the credentials objects returned are self\-refreshing, as descibed in the [AWS SDK for Javascript](https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/Credentials.html) documentation\.